<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.17.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MATE Desktop Environment: travis Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mate-logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">MATE Desktop Environment
   </div>
   <div id="projectbrief">The continuation of GNOME 2. An intuitive and attractive desktop for Linux and Unix-like operating systems.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.17.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav-mobile">
<div class="sm sm-dox"><input id="main-menu-state" type="checkbox"/>
<label class="main-menu-btn" for="main-menu-state">
<span class="main-menu-btn-icon"></span> Toggle main menu visibility</label>
<span id="searchBoxPos1" style="position:absolute;right:8px;top:8px;height:36px;"></span>
</div>
</div><!-- main-nav-mobile -->
<div id="main-nav">
  <ul class="sm sm-dox" id="main-menu">
    <li id="searchBoxPos2" style="float:right">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
    </li>
  </ul>
</div><!-- main-nav -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_26c3cf2246321c119de4295396ae34f0.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">travis Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for travis:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="dir_26c3cf2246321c119de4295396ae34f0_dep.svg" width="156" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><h1 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
README</h1>
<p><span class="tt">docker-build</span> is a generic script that using the Docker container to build for the different distributions. It requires a configuration file to work with. By default, a YAML file called <span class="tt">.docker-build.yml</span> is used.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
Usage</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
Command line usage</h2>
<div class="fragment"><div class="line">usage: docker-build [-h] [-c FILE] [-n IMAGE] [-l N] [-s] [-v] [-i]</div>
<div class="line">                    [-b autotools|meson|scripts] [-r github|scripts] [-t TAG]</div>
<div class="line">                    [--version] [-C]</div>
<div class="line"> </div>
<div class="line">Compile the software in a Docker container</div>
<div class="line"> </div>
<div class="line">optional arguments:</div>
<div class="line">  -h, --help            show this help message and exit</div>
<div class="line">  -c FILE, --config FILE</div>
<div class="line">                        The config file (default is &quot;.docker-build.yml&quot;)</div>
<div class="line">  -n IMAGE, --name IMAGE</div>
<div class="line">                        Docker image name (default is &quot;fedora&quot;)</div>
<div class="line">  -l N, --limit N       Limit the number of output lines (default is 100)</div>
<div class="line">  -s, --shell           Run interactive bash in the docker container.</div>
<div class="line">  -v, --verbose         Verbose output, the number of output lines is not</div>
<div class="line">                        limited</div>
<div class="line">  -i, --install         Install dependent packages in docker container.</div>
<div class="line">  -b autotools|meson|scripts, --build autotools|meson|scripts</div>
<div class="line">                        Compile the software in docker container.</div>
<div class="line">  -r github|scripts, --release github|scripts</div>
<div class="line">                        Release the tarballs.</div>
<div class="line">  -t TAG, --tag TAG     Release based on which tag.(default to use</div>
<div class="line">                        &quot;TRAVIS_TAG&quot; envirment variable)</div>
<div class="line">  --version             Show the version</div>
<div class="line">  -C, --clean           Clean up the docker container.</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
Steps by Step</h2>
<p>Make sure the docker works in the system and don't see the error output by running the <span class="tt">docker images</span> command.</p>
<ol type="1">
<li>Go to the source directory, for example <span class="tt">mate-menus</span>.</li>
<li>Create a <span class="tt">.docker-build.yml</span> file with the following content:</li>
</ol>
<div class="fragment"><div class="line">requires:</div>
<div class="line">  ubuntu:</div>
<div class="line">    - mate-common</div>
<div class="line">    - intltool</div>
<div class="line">    - python</div>
</div><!-- fragment --><p>If there are more dependencies, you need to add them.</p>
<ol type="1">
<li>Install the dependency package in the Docker container of <span class="tt">ubuntu 18.10</span>.</li>
</ol>
<p>Run the command:</p>
<div class="fragment"><div class="line">docker-build --name ubuntu:18.10 --install</div>
</div><!-- fragment --><p>It will download the ubuntu 18.10 docker image, run it and install the dependencies in the container.</p>
<p>The dependency package is written in the configuration file in the 2nd step.</p>
<p>**Note: **</p>
<p>If you find that the distro packages download is too slow when local debugging, you can write <span class="tt">~/.distro_hook</span> script in source directory to modify OS repo url.</p>
<p>Here is an example file:</p>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">if [ $# -ne 1 ];then</div>
<div class="line">        exit 0</div>
<div class="line">else</div>
<div class="line">        distro=$1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">case $distro in</div>
<div class="line">        archlinux)</div>
<div class="line">                echo &#39;Server = http://mirrors.163.com/archlinux/$repo/os/$arch&#39; &gt; /etc/pacman.d/mirrorlist</div>
<div class="line">                ;;</div>
<div class="line">        debian)</div>
<div class="line">                sed -i -s &#39;s/deb.debian.org/mirrors.163.com/g&#39; /etc/apt/sources.list</div>
<div class="line">                ;;</div>
<div class="line">        ubuntu)</div>
<div class="line">                sed -i -s &#39;s/archive.ubuntu.com/mirrors.163.com/g&#39; /etc/apt/sources.list</div>
<div class="line">                ;;</div>
<div class="line">        *)</div>
<div class="line">                true</div>
<div class="line">                ;;</div>
<div class="line">esac</div>
</div><!-- fragment --><ol type="1">
<li>Start building with autotools by running the follow command:</li>
</ol>
<div class="fragment"><div class="line">docker-build --name ubuntu:18.10 --verbose --build autotools</div>
</div><!-- fragment --><p>You may see an error, usually because of a lack of dependencies, you can try adding it in <span class="tt">.docker-build.yml</span> and run it again.</p>
<p>If you want to delete the container, run the follow command: </p><div class="fragment"><div class="line">docker-build --name ubuntu:18.10 --clean</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md31"></a>
Configuration file format</h1>
<p><span class="tt">docker-build</span> requires a configuration file to run, which can be saved in JSON or YAML formats with similar structures, default use YAML format, called <span class="tt">.docker-build.yml</span>.</p>
<p>If you want to use a different configuration file name, please use the <span class="tt">docker-build --config another_config_file</span>.</p>
<p>In the configuration file, the following configuration items are included:</p><ol type="1">
<li><span class="tt">requires</span>: The compile dependency packages for different Linux distro, create sub-key <span class="tt">ubuntu</span> for ubuntu distro.</li>
<li><span class="tt">configures</span>: The compilation parameters to be used for <span class="tt">./configure</span> and <span class="tt">meson</span>, create sub-key <span class="tt">autotools</span> for autotools, sub-key <span class="tt">meson</span> for meson.</li>
<li><span class="tt">before_scripts</span>: The commands to be executed before build.</li>
<li><span class="tt">after_scripts</span>: The commands to be executed after build.</li>
<li><span class="tt">variables</span>: The environment variables to be used when building.</li>
</ol>
<p>In the configuration file, only <span class="tt">requires</span> is required, others are optional.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md32"></a>
Environmental variable</h2>
<p>The following environment variables can be used in before/after scripts:</p>
<ul>
<li><b>BUILD_TYPE</b> : Compile type, autotools or meson</li>
<li><b>DISTRO_NAME</b> : The distro name, such as <em>debian</em> or <em>fedora</em></li>
<li><b>DISTRO_VERSION</b> : The distro version</li>
<li><b>LIMIT</b> - : Maximum number of output lines</li>
<li><b>START_DIR</b> : The source code directory</li>
<li><b>BUILD_DIR</b> : The compile directory</li>
<li><b>VERBOSE</b> : Whether the detailed output is set</li>
<li><b>CONTAINER_NAME</b> : Container name</li>
</ul>
<p>For example:</p>
<div class="fragment"><div class="line">requires:</div>
<div class="line">  ubuntu:</div>
<div class="line">    - mate-common</div>
<div class="line">    - intltool</div>
<div class="line">    - python</div>
<div class="line">  fedora:</div>
<div class="line">    - dbus-glib-devel</div>
<div class="line">    - desktop-file-utils</div>
<div class="line">    - git</div>
<div class="line">    - libcanberra-devel</div>
<div class="line">    - libnotify-devel</div>
<div class="line">    - libwnck3-devel</div>
<div class="line">    - mate-common</div>
<div class="line">    - mate-desktop-devel</div>
<div class="line">  centos:</div>
<div class="line">    - dbus-glib-devel</div>
<div class="line">    - desktop-file-utils</div>
<div class="line">    - libcanberra-devel</div>
<div class="line">    - libnotify-devel</div>
<div class="line">    - libwnck3-devel</div>
<div class="line">    - mate-common</div>
<div class="line">    - mate-desktop-devel</div>
<div class="line">before_scripts:</div>
<div class="line">  - pwd</div>
<div class="line">  - env</div>
<div class="line">variables:</div>
<div class="line">  - CFLAGS=&quot;-Wall&quot;</div>
<div class="line">configures:</div>
<div class="line">  autotools:</div>
<div class="line">    - --prefix=/usr</div>
<div class="line">    - --enable-gtk-doc</div>
<div class="line">  meson:</div>
<div class="line">    - --prefix /usr</div>
<div class="line">    - -Denable-gtk-doc=true</div>
<div class="line">after_scripts:</div>
<div class="line">  - if [ &quot;$BUILD_TYPE&quot; = &quot;meson&quot; ]; then meson test; else make test; fi</div>
<div class="line">  - if [ &quot;$BUILD_TYPE&quot; = &quot;meson&quot; ]; then ninja dist; else make distcheck; fi</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md33"></a>
Travis CI</h1>
<p>Travis CI provides Continuous Integration (CI). It binds the project on Github and will automatically fetch as long as there is new code. Then, provide a runtime environment, perform tests, complete the build, and deploy to the server.</p>
<p>Travis CI only supports Github and does not support other code hosting services. This means that you must meet the following conditions in order to use Travis CI.</p>
<ul>
<li>Have a GitHub account</li>
<li>There is a project below this account</li>
<li>There are runnable code in the project.</li>
<li>The project also includes build or test scripts</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md34"></a>
Start Travis CI</h2>
<ol type="1">
<li>First, visit the official website travis-ci.org, click on the profile picture in the upper right corner, and log in to Travis CI using your Github account.</li>
</ol>
<p>Travis will list all of your warehouses on Github and the organizations you belong to. At this point, select the warehouse you need Travis to build for you, and open the switch next to the warehouse. Once a repository is activated, Travis will listen for all changes to the repository.</p>
<ol type="1">
<li>Write <span class="tt">.travis.yml</span></li>
</ol>
<p>Travis requires a <span class="tt">.travis.yml</span> file under the root of the project. This is a configuration file that specifies the behavior of Travis. The file must be saved in the Github repository. Once the code repository has a new Commit, Travis will go to the file and execute the commands.</p>
<p>This file is in YAML format. Below is a <span class="tt">.travis.yml</span> file for the simplest Python project.</p>
<div class="fragment"><div class="line">language: python</div>
<div class="line">script: true</div>
</div><!-- fragment --><p>See the documentation for more details: <a href="https://docs.travis-ci.com/">https://docs.travis-ci.com/</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md35"></a>
Run docker-build on Travis CI</h1>
<ol type="1">
<li>First need Travis CI to work in your repo.</li>
<li>Create a <span class="tt">.travis.yml</span> file with the following content:</li>
</ol>
<div class="fragment"><div class="line">dist: xenial</div>
<div class="line">sudo: required</div>
<div class="line">language: bash</div>
<div class="line">services:</div>
<div class="line">  - docker</div>
<div class="line"> </div>
<div class="line">before_install:</div>
<div class="line">  - curl -L -o docker-build https://github.com/yetist/mate-dev-scripts/raw/travis/travis/docker-build</div>
<div class="line">  - chmod +x docker-build</div>
<div class="line"> </div>
<div class="line">install:</div>
<div class="line">  - sudo apt-get install -y python3-pip python3-setuptools</div>
<div class="line">  - sudo pip3 install --upgrade pip</div>
<div class="line">  - sudo pip install PyGithub</div>
<div class="line">  - ./docker-build --name ${DISTRO} --install</div>
<div class="line"> </div>
<div class="line">script:</div>
<div class="line">  - ./docker-build --name ${DISTRO} --verbose --build autotools</div>
<div class="line"> </div>
<div class="line">env:</div>
<div class="line">  - DISTRO=&quot;ubuntu:18.10&quot;</div>
</div><!-- fragment --><p>If the project is built using <span class="tt">meson</span>, modify the command in the <span class="tt">script</span> like this: </p><div class="fragment"><div class="line">- ./docker-build --name ${DISTRO} --verbose --build meson </div>
</div><!-- fragment --><p>If you want to support more distro, add a similar line to env :</p>
<div class="fragment"><div class="line">env:</div>
<div class="line">  - DISTRO=&quot;archlinux/base&quot;</div>
<div class="line">  - DISTRO=&quot;debian:sid&quot;</div>
<div class="line">  - DISTRO=&quot;fedora:29&quot;</div>
<div class="line">  - DISTRO=&quot;ubuntu:18.10&quot;</div>
</div><!-- fragment --><ol type="1">
<li>Create a <span class="tt">.docker-build.yml</span></li>
</ol>
<p>Please refer to the above description for the content.</p>
<p>If you don't want to add this file to your git repo, you can merge the contents of this file into a <span class="tt">.travis.yml</span> file and modify the <span class="tt">.travis.yml</span> file to add the <span class="tt">--config .travis.yml</span> parameter to the <span class="tt">docker-build</span> command. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_6c1c1c2cd08fe63359e52eb67558dfda.html">mate-dev-scripts</a></li><li class="navelem"><a href="dir_26c3cf2246321c119de4295396ae34f0.html">travis</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.17.0 </li>
  </ul>
</div>
</body>
</html>
